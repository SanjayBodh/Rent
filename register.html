
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Firebase Auth</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<form id="MainForm" class="w-20 m-4">
  <h2 class="mb-3">Register User</h2> 
  <div class="form-floating mb-3">
    <input type="email" class="form-control" id="email" placeholder="name@example.com">
    <label for="floatingInput">Email address</label>
  </div>
  <div class="form-floating mb-3">
    <input type="password" class="form-control" id="Password" placeholder="Password">
    <label for="floatingPassword">Password</label>
  </div>
  <div class="form-floating mb-3">
    <input type="text" class="form-control" id="first" placeholder="First Name">
    <label for="floatingInput">First Name</label>
  </div>
  <div class="form-floating mb-3">
    <input type="text" class="form-control" id="last" placeholder="Last Name">
    <label for="floatingPassword">Last Name</label>
  </div>
  <div class="form-floating mb-3">
    <input type="tel" class="form-control" id="phone" placeholder="Phone Number">
    <label for="floatingPassword">Phone Number</label>
  </div>
  <input type="submit" class="btn btn-primary" style="float: right" id="hideButton" value="Register">
  <a href="signin.html"><button type="button" id="HideButton" class="btn btn-primary me-2" style="float: right">Sign In</button></a>
</form>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
  import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

 const firebaseConfig = {
    apiKey: "AIzaSyBRZrQ35ZCsWtJ_Dvcq0w0iOED2ypXv89w",
    authDomain: "databse-b7f4b.firebaseapp.com",
    databaseURL: "https://databse-b7f4b-default-rtdb.firebaseio.com",
    projectId: "databse-b7f4b",
    storageBucket: "databse-b7f4b.appspot.com",
    messagingSenderId: "440573409846",
    appId: "1:440573409846:web:4a49d38fc1d5e5bb803697",
    measurementId: "G-JE7M0T3QSJ"
  };
   
   
  const app = initializeApp(firebaseConfig);
  const DB = getDatabase();
  const auth = getAuth(app);

  let email = document.getElementById('email');
  let password = document.getElementById('Password');
  let first = document.getElementById('first');
  let last = document.getElementById('last');
  let phone = document.getElementById('phone');
  let MainForm = document.getElementById('MainForm');

 

   let RegisterUser = evt => {
  evt.preventDefault(); 

  let allowedDomains = ['gmail.com', 'icloud.com', 'yahoo.com'];
  let validEmail = false;

  for (let domain of allowedDomains) {
    if (email.value.endsWith('@' + domain)) {
      validEmail = true;
      break;
    }
  }

  if (!validEmail) {
    alert("Invalid email address. Please enter a valid email we accept only (Gmail.com) (icloud.com) (yahoo.com).");
    return;
  }

  createUserWithEmailAndPassword(auth, email.value, password.value)
    .then((credentials) => {
      // Once registered, store additional user data in the database
      set(ref(DB, 'UsersAuthList/' + credentials.user.uid), {
        email: email.value,
        password: password.value,
        firstname: first.value,
        lastname: last.value,
        phoneNumber: phone.value
      }).then(() => {
        alert("Registration successful!");
        window.location.href = 'signin.html'; // Redirect after successful registration
      }).catch((error) => {
        alert("Failed to store user data: " + error.message);
        console.error("Database write error:", error);
      });
    })
    .catch((error) => {
      let errorMessage = error.message;

      // Customize error messages based on error codes
      switch (error.code) {
        case 'auth/email-already-in-use':
          errorMessage = 'The email address is already in use.';
          break;
        case 'auth/weak-password':
          errorMessage = 'The password is too weak.';
          break;
        case 'auth/invalid-email':
          errorMessage = 'The email address is not valid.';
          break;
        case 'auth/user-not-found':
          errorMessage = 'No user found with this email address.';
          break;
        case 'auth/wrong-password':
          errorMessage = 'The password is incorrect.';
          break;
        case 'auth/network-request-failed':
          errorMessage = 'Network request failed. Please check your internet connection.';
          break;
        // Add more cases for other error codes
        default:
          errorMessage = 'Registration failed: ' + errorMessage;
          break;
      }

      alert(errorMessage);
      console.error("Registration error:", error);
    });
};


  MainForm.addEventListener('submit', RegisterUser);
</script>
<script>
 
  function hideAndPreventBack() {
 
    history.pushState(null, null, 'signin.html');
    
   
    window.location.href = 'signin.html'; 
  }

  document.getElementById('hideButton').addEventListener('click', hideAndPreventBack);
</script>
<script>
 
  function HideAndPreventBack() {
 
    history.pushState(null, null, 'signin.html');
    
   
    window.location.href = 'signin.html'; 
  }

  document.getElementById('HideButton').addEventListener('click', HideAndPreventBack);
</script>
</body>
</html>