<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>firebase auth</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<form id="MainForm" class="w-20 m-4">
<h2 class="mb-3">signin user</h2> 
   <div class="form-floating mb-3">
  <input type="email" class="form-control" id="email" placeholder="name@example.com">
  <label for="floatingInput">Email address</label>
</div>
<div class="form-floating mb-3">
  <input type="password" class="form-control" id="Password" placeholder="Password">
  <label for="floatingPassword">Password</label>
</div>

<a href="reset.html"><label style="cursor:pointer;margin-top:8px; margin-left:2px;">Forget password</label></a>
<input type="submit"  class="btn btn-primary" id="HideButton" style="float: right" value="signin">
<a href="register.html"><button type="button" id="hideButton" class="btn btn-primary me-2" style="float: right">register</button></a>

</form>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
  import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword,sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBRZrQ35ZCsWtJ_Dvcq0w0iOED2ypXv89w",
    authDomain: "databse-b7f4b.firebaseapp.com",
    databaseURL: "https://databse-b7f4b-default-rtdb.firebaseio.com",
    projectId: "databse-b7f4b",
    storageBucket: "databse-b7f4b.appspot.com",
    messagingSenderId: "440573409846",
    appId: "1:440573409846:web:4a49d38fc1d5e5bb803697",
    measurementId: "G-JE7M0T3QSJ"
  };
   
  const app = initializeApp(firebaseConfig);
  const db = getDatabase();
  const auth = getAuth(app);
  const dbref = ref(db);

  let email = document.getElementById('email');
  let password = document.getElementById('Password');
  let MainForm = document.getElementById('MainForm');
  let Forgetpassowrd = document.getElementById('forgetpassword');

  let signInUser = evt => {
    evt.preventDefault();

    signInWithEmailAndPassword(auth, email.value, password.value)
      .then((credentials) => {
        get(child(dbref, 'UsersAuthList/' + credentials.user.uid)).then((snapshot) => {
          if (snapshot.exists()) {
            sessionStorage.setItem("user-info", JSON.stringify({
              firstname: snapshot.val().firstname,
              lastname: snapshot.val().lastname,
              number: snapshot.val().number
            }));
            sessionStorage.setItem("user-creds", JSON.stringify(credentials.user));
            window.location.href = 'index.html';
          } else {
            alert("User data not found.");
          }
        });
      })
      .catch((error) => {
      let errorMessage = error.message;

      // Customize error messages based on error codes
      switch (error.code) {
        case 'auth/invalid-email':
          errorMessage = 'The email address is not valid.';
          break;
        case 'auth/user-not-found':
          errorMessage = 'No user found with this email address.';
          break;
        case 'auth/wrong-password':
          errorMessage = 'The password is incorrect.';
          break;
        case 'auth/network-request-failed':
          errorMessage = 'Network request failed. Please check your internet connection.';
          break;
          default:
          errorMessage = 'Registration failed: ' + errorMessage;
          break;
         case 'auth/invalid-credential':
  errorMessage = 'Invalid credentials. Please double-check your email and password.';
  break;

      }

      alert(errorMessage);
      console.error("Registration error:", error);
    });
  };

let Forgetpassword

  MainForm.addEventListener('submit', signInUser);

</script>
<script>
 
  function hideAndPreventBack() {
 
    history.pushState(null, null, 'register.html');
    
   
    window.location.href = 'register.html'; 
  }

  document.getElementById('hideButton').addEventListener('click', hideAndPreventBack);
</script>
<script>
 
  function HideAndPreventBack() {
 
    history.pushState(null, null, 'index.html'); to
    
  
    window.location.href = 'index.html'; 
  }

  document.getElementById('HideButton').addEventListener('click', HideAndPreventBack);
</script>
</body>
</html>
